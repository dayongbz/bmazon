{"ast":null,"code":"import _Object$values from \"@babel/runtime-corejs2/core-js/object/values\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport { all, fork, takeEvery, call, put } from 'redux-saga/effects';\nimport axios from 'axios';\nimport cheerio from 'cheerio';\nimport { PRODUCT_INFORMATION_SUCCESS, PRODUCT_INFORMATION_REQUEST, PRODUCT_INFORMATION_FAILURE, PRODUCT_OPTION_INFORMATION_REQUEST, PRODUCT_OPTION_INFORMATION_SUCCESS, PRODUCT_OPTION_INFORMATION_FAILURE } from '../reducers/product';\n\nfunction getProductInfoAPI({\n  asin\n}) {\n  return axios(`/api/product/${asin}`);\n}\n\nfunction* getProductInfo(action) {\n  try {\n    const result = yield call(getProductInfoAPI, action.data);\n    const $ = yield cheerio.load(result.data);\n    const category = [];\n    const optionDatas = [];\n    const options = {\n      option: []\n    };\n    yield $('div#breadcrumb_feature_div a.a-link-child').each((i, elem) => {\n      category.push($(elem).text().trim());\n    });\n    yield $('script').filter((i, e) => {\n      const data = $(e).data('a-state');\n\n      if (typeof data === 'object') {\n        return data.key === 'mobile-twister-dim-val-list' || data.key === 'mobile-twister-dims-to-asin-list' || data.key === 'mobile-twister-dim-list';\n      }\n    }).each((i, e) => {\n      optionDatas[$(e).data('a-state').key] = JSON.parse($(e)[0].firstChild.data);\n    });\n    yield (() => {\n      options.listName = optionDatas['mobile-twister-dim-list'].key;\n      options.listValue = optionDatas['mobile-twister-dim-val-list'];\n\n      const key = _Object$keys(optionDatas['mobile-twister-dims-to-asin-list']).map(item => item.match(/(\\d)/g));\n\n      const value = _Object$values(optionDatas['mobile-twister-dims-to-asin-list']);\n\n      options.option = key.map((item, index) => ({\n        asin: value[index],\n        list: item\n      }));\n    })(); // 늦게 로딩되는 이미지 로딩\n\n    yield $('div#aplus_feature_div').children('div').find('img').filter((i, e) => $(e).hasClass('a-lazy-loaded')).each((i, e) => {\n      $(e).attr('src', $(e).data('src'));\n    });\n    yield put({\n      type: PRODUCT_INFORMATION_SUCCESS,\n      data: {\n        imageUrl: $('img#main-image').data('a-hires'),\n        price: $('div#cerberus-data-metrics').data('asin-price') || $('#priceblock_ourprice').text().trim().substring(1),\n        name: $('span#title').text().trim(),\n        category: category,\n        details: $('div#aplus3p_feature_div').length !== 0 ? $('div#aplus3p_feature_div').children('div').html() : $('div#aplus_feature_div').children('div').html(),\n        options: options\n      }\n    });\n  } catch (e) {\n    console.error(e);\n    yield put({\n      type: PRODUCT_INFORMATION_FAILURE\n    });\n  }\n}\n\nfunction* watchProductInfo() {\n  yield takeEvery(PRODUCT_INFORMATION_REQUEST, getProductInfo);\n}\n\nfunction getOptionAPI(data) {\n  return axios(`/api/product/option/${data.asin}`);\n}\n\nfunction* getOptionInfo(action) {\n  try {\n    let data = yield call(getOptionAPI, action.data);\n    data = yield data.data.filter(item => item.asin === action.data.asin)[0];\n    console.log(data, action.data.asin, action.data.index);\n    yield put({\n      type: PRODUCT_OPTION_INFORMATION_SUCCESS,\n      data: {\n        imageUrl: data.imageUrl,\n        asin: action.data.asin,\n        index: action.data.index\n      }\n    });\n  } catch (e) {\n    console.log(e);\n    yield put({\n      type: PRODUCT_OPTION_INFORMATION_FAILURE\n    });\n  }\n}\n\nfunction* watchOptionInfo() {\n  yield takeEvery(PRODUCT_OPTION_INFORMATION_REQUEST, getOptionInfo);\n}\n\nexport default function* productSaga() {\n  yield all([fork(watchProductInfo), fork(watchOptionInfo)]);\n}","map":{"version":3,"sources":["/Users/dayong/Desktop/dev/bmazon/sagas/product.js"],"names":["all","fork","takeEvery","call","put","axios","cheerio","PRODUCT_INFORMATION_SUCCESS","PRODUCT_INFORMATION_REQUEST","PRODUCT_INFORMATION_FAILURE","PRODUCT_OPTION_INFORMATION_REQUEST","PRODUCT_OPTION_INFORMATION_SUCCESS","PRODUCT_OPTION_INFORMATION_FAILURE","getProductInfoAPI","asin","getProductInfo","action","result","data","$","load","category","optionDatas","options","option","each","i","elem","push","text","trim","filter","e","key","JSON","parse","firstChild","listName","listValue","map","item","match","value","index","list","children","find","hasClass","attr","type","imageUrl","price","substring","name","details","length","html","console","error","watchProductInfo","getOptionAPI","getOptionInfo","log","watchOptionInfo","productSaga"],"mappings":"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","sourcesContent":["import { all, fork, takeEvery, call, put } from 'redux-saga/effects';\nimport axios from 'axios';\nimport cheerio from 'cheerio';\n\nimport {\n  PRODUCT_INFORMATION_SUCCESS,\n  PRODUCT_INFORMATION_REQUEST,\n  PRODUCT_INFORMATION_FAILURE,\n  PRODUCT_OPTION_INFORMATION_REQUEST,\n  PRODUCT_OPTION_INFORMATION_SUCCESS,\n  PRODUCT_OPTION_INFORMATION_FAILURE,\n} from '../reducers/product';\n\nfunction getProductInfoAPI({ asin }) {\n  return axios(`/api/product/${asin}`);\n}\n\nfunction* getProductInfo(action) {\n  try {\n    const result = yield call(getProductInfoAPI, action.data);\n    const $ = yield cheerio.load(result.data);\n    const category = [];\n    const optionDatas = [];\n    const options = { option: [] };\n\n    yield $('div#breadcrumb_feature_div a.a-link-child').each((i, elem) => {\n      category.push(\n        $(elem)\n          .text()\n          .trim(),\n      );\n    });\n\n    yield $('script')\n      .filter((i, e) => {\n        const data = $(e).data('a-state');\n        if (typeof data === 'object') {\n          return (\n            data.key === 'mobile-twister-dim-val-list' ||\n            data.key === 'mobile-twister-dims-to-asin-list' ||\n            data.key === 'mobile-twister-dim-list'\n          );\n        }\n      })\n      .each((i, e) => {\n        optionDatas[$(e).data('a-state').key] = JSON.parse(\n          $(e)[0].firstChild.data,\n        );\n      });\n\n    yield (() => {\n      options.listName = optionDatas['mobile-twister-dim-list'].key;\n      options.listValue = optionDatas['mobile-twister-dim-val-list'];\n      const key = Object.keys(\n        optionDatas['mobile-twister-dims-to-asin-list'],\n      ).map(item => item.match(/(\\d)/g));\n      const value = Object.values(\n        optionDatas['mobile-twister-dims-to-asin-list'],\n      );\n      options.option = key.map((item, index) => ({\n        asin: value[index],\n        list: item,\n      }));\n    })();\n\n    // 늦게 로딩되는 이미지 로딩\n    yield $('div#aplus_feature_div')\n      .children('div')\n      .find('img')\n      .filter((i, e) => $(e).hasClass('a-lazy-loaded'))\n      .each((i, e) => {\n        $(e).attr('src', $(e).data('src'));\n      });\n\n    yield put({\n      type: PRODUCT_INFORMATION_SUCCESS,\n      data: {\n        imageUrl: $('img#main-image').data('a-hires'),\n        price:\n          $('div#cerberus-data-metrics').data('asin-price') ||\n          $('#priceblock_ourprice')\n            .text()\n            .trim()\n            .substring(1),\n        name: $('span#title')\n          .text()\n          .trim(),\n        category: category,\n        details:\n          $('div#aplus3p_feature_div').length !== 0\n            ? $('div#aplus3p_feature_div')\n                .children('div')\n                .html()\n            : $('div#aplus_feature_div')\n                .children('div')\n                .html(),\n        options: options,\n      },\n    });\n  } catch (e) {\n    console.error(e);\n    yield put({\n      type: PRODUCT_INFORMATION_FAILURE,\n    });\n  }\n}\n\nfunction* watchProductInfo() {\n  yield takeEvery(PRODUCT_INFORMATION_REQUEST, getProductInfo);\n}\n\nfunction getOptionAPI(data) {\n  return axios(`/api/product/option/${data.asin}`);\n}\n\nfunction* getOptionInfo(action) {\n  try {\n    let data = yield call(getOptionAPI, action.data);\n    data = yield data.data.filter(item => item.asin === action.data.asin)[0];\n    console.log(data, action.data.asin, action.data.index);\n    yield put({\n      type: PRODUCT_OPTION_INFORMATION_SUCCESS,\n      data: {\n        imageUrl: data.imageUrl,\n        asin: action.data.asin,\n        index: action.data.index,\n      },\n    });\n  } catch (e) {\n    console.log(e);\n    yield put({\n      type: PRODUCT_OPTION_INFORMATION_FAILURE,\n    });\n  }\n}\n\nfunction* watchOptionInfo() {\n  yield takeEvery(PRODUCT_OPTION_INFORMATION_REQUEST, getOptionInfo);\n}\n\nexport default function* productSaga() {\n  yield all([fork(watchProductInfo), fork(watchOptionInfo)]);\n}\n"]},"metadata":{},"sourceType":"module"}