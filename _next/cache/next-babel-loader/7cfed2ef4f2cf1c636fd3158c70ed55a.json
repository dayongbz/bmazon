{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _Object$values from \"@babel/runtime-corejs2/core-js/object/values\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\n\nvar _marked =\n/*#__PURE__*/\n_regeneratorRuntime.mark(getProductInfo),\n    _marked2 =\n/*#__PURE__*/\n_regeneratorRuntime.mark(watchProductInfo),\n    _marked3 =\n/*#__PURE__*/\n_regeneratorRuntime.mark(getOptionInfo),\n    _marked4 =\n/*#__PURE__*/\n_regeneratorRuntime.mark(watchOptionInfo),\n    _marked5 =\n/*#__PURE__*/\n_regeneratorRuntime.mark(productSaga);\n\nimport { all, fork, takeEvery, call, put } from 'redux-saga/effects';\nimport axios from 'axios';\nimport cheerio from 'cheerio';\nimport { PRODUCT_INFORMATION_SUCCESS, PRODUCT_INFORMATION_REQUEST, PRODUCT_INFORMATION_FAILURE, PRODUCT_OPTION_INFORMATION_REQUEST, PRODUCT_OPTION_INFORMATION_SUCCESS, PRODUCT_OPTION_INFORMATION_FAILURE } from '../reducers/product';\n\nfunction getProductInfoAPI(_ref) {\n  var asin = _ref.asin;\n  return axios(\"/api/product/\".concat(asin));\n}\n\nfunction getProductInfo(action) {\n  var result, $, category, optionDatas, options;\n  return _regeneratorRuntime.wrap(function getProductInfo$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          _context.prev = 0;\n          _context.next = 3;\n          return call(getProductInfoAPI, action.data);\n\n        case 3:\n          result = _context.sent;\n          _context.next = 6;\n          return cheerio.load(result.data);\n\n        case 6:\n          $ = _context.sent;\n          category = [];\n          optionDatas = [];\n          options = {\n            option: []\n          };\n          _context.next = 12;\n          return $('div#breadcrumb_feature_div a.a-link-child').each(function (i, elem) {\n            category.push($(elem).text().trim());\n          });\n\n        case 12:\n          _context.next = 14;\n          return $('script').filter(function (i, e) {\n            var data = $(e).data('a-state');\n\n            if (typeof data === 'object') {\n              return data.key === 'mobile-twister-dim-val-list' || data.key === 'mobile-twister-dims-to-asin-list' || data.key === 'mobile-twister-dim-list';\n            }\n          }).each(function (i, e) {\n            optionDatas[$(e).data('a-state').key] = JSON.parse($(e)[0].firstChild.data);\n          });\n\n        case 14:\n          _context.next = 16;\n          return function () {\n            options.listName = optionDatas['mobile-twister-dim-list'].key;\n            options.listValue = optionDatas['mobile-twister-dim-val-list'];\n\n            var key = _Object$keys(optionDatas['mobile-twister-dims-to-asin-list']).map(function (item) {\n              return item.match(/(\\d)/g);\n            });\n\n            var value = _Object$values(optionDatas['mobile-twister-dims-to-asin-list']);\n\n            options.option = key.map(function (item, index) {\n              return {\n                asin: value[index],\n                list: item\n              };\n            });\n          }();\n\n        case 16:\n          _context.next = 18;\n          return $('div#aplus_feature_div').children('div').find('img').filter(function (i, e) {\n            return $(e).hasClass('a-lazy-loaded');\n          }).each(function (i, e) {\n            $(e).attr('src', $(e).data('src'));\n          });\n\n        case 18:\n          _context.next = 20;\n          return put({\n            type: PRODUCT_INFORMATION_SUCCESS,\n            data: {\n              imageUrl: $('img#main-image').data('a-hires'),\n              price: $('div#cerberus-data-metrics').data('asin-price') || $('#priceblock_ourprice').text().trim().substring(1),\n              name: $('span#title').text().trim(),\n              category: category,\n              details: $('div#aplus3p_feature_div').length !== 0 ? $('div#aplus3p_feature_div').children('div').html() : $('div#aplus_feature_div').children('div').html(),\n              options: options\n            }\n          });\n\n        case 20:\n          _context.next = 27;\n          break;\n\n        case 22:\n          _context.prev = 22;\n          _context.t0 = _context[\"catch\"](0);\n          console.error(_context.t0);\n          _context.next = 27;\n          return put({\n            type: PRODUCT_INFORMATION_FAILURE\n          });\n\n        case 27:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, _marked, null, [[0, 22]]);\n}\n\nfunction watchProductInfo() {\n  return _regeneratorRuntime.wrap(function watchProductInfo$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.next = 2;\n          return takeEvery(PRODUCT_INFORMATION_REQUEST, getProductInfo);\n\n        case 2:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, _marked2);\n}\n\nfunction getOptionAPI(data) {\n  return axios(\"/api/product/option/\".concat(data.asin));\n}\n\nfunction getOptionInfo(action) {\n  var data;\n  return _regeneratorRuntime.wrap(function getOptionInfo$(_context3) {\n    while (1) {\n      switch (_context3.prev = _context3.next) {\n        case 0:\n          _context3.prev = 0;\n          _context3.next = 3;\n          return call(getOptionAPI, action.data);\n\n        case 3:\n          data = _context3.sent;\n          _context3.next = 6;\n          return data.data.filter(function (item) {\n            return item.asin === action.data.asin;\n          })[0];\n\n        case 6:\n          data = _context3.sent;\n          console.log(data, action.data.asin, action.data.index);\n          _context3.next = 10;\n          return put({\n            type: PRODUCT_OPTION_INFORMATION_SUCCESS,\n            data: {\n              imageUrl: data.imageUrl,\n              asin: action.data.asin,\n              index: action.data.index\n            }\n          });\n\n        case 10:\n          _context3.next = 17;\n          break;\n\n        case 12:\n          _context3.prev = 12;\n          _context3.t0 = _context3[\"catch\"](0);\n          console.log(_context3.t0);\n          _context3.next = 17;\n          return put({\n            type: PRODUCT_OPTION_INFORMATION_FAILURE\n          });\n\n        case 17:\n        case \"end\":\n          return _context3.stop();\n      }\n    }\n  }, _marked3, null, [[0, 12]]);\n}\n\nfunction watchOptionInfo() {\n  return _regeneratorRuntime.wrap(function watchOptionInfo$(_context4) {\n    while (1) {\n      switch (_context4.prev = _context4.next) {\n        case 0:\n          _context4.next = 2;\n          return takeEvery(PRODUCT_OPTION_INFORMATION_REQUEST, getOptionInfo);\n\n        case 2:\n        case \"end\":\n          return _context4.stop();\n      }\n    }\n  }, _marked4);\n}\n\nexport default function productSaga() {\n  return _regeneratorRuntime.wrap(function productSaga$(_context5) {\n    while (1) {\n      switch (_context5.prev = _context5.next) {\n        case 0:\n          _context5.next = 2;\n          return all([fork(watchProductInfo), fork(watchOptionInfo)]);\n\n        case 2:\n        case \"end\":\n          return _context5.stop();\n      }\n    }\n  }, _marked5);\n}","map":null,"metadata":{},"sourceType":"module"}