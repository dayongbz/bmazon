{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _Object$values from \"@babel/runtime-corejs2/core-js/object/values\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\n\nvar _marked =\n/*#__PURE__*/\n_regeneratorRuntime.mark(getProductInfo),\n    _marked2 =\n/*#__PURE__*/\n_regeneratorRuntime.mark(watchProductInfo),\n    _marked3 =\n/*#__PURE__*/\n_regeneratorRuntime.mark(getOptionInfo),\n    _marked4 =\n/*#__PURE__*/\n_regeneratorRuntime.mark(watchOptionInfo),\n    _marked5 =\n/*#__PURE__*/\n_regeneratorRuntime.mark(productSaga);\n\nimport { all, fork, takeEvery, call, put } from 'redux-saga/effects';\nimport axios from 'axios';\nimport cheerio from 'cheerio';\nimport { PRODUCT_INFORMATION_SUCCESS, PRODUCT_INFORMATION_REQUEST, PRODUCT_INFORMATION_FAILURE, PRODUCT_OPTION_INFORMATION_REQUEST, PRODUCT_OPTION_INFORMATION_SUCCESS, PRODUCT_OPTION_INFORMATION_FAILURE } from '../reducers/product';\n\nfunction getProductInfoAPI(_ref) {\n  var asin = _ref.asin;\n  return axios(\"/api/product/\".concat(asin));\n}\n\nfunction getProductInfo(action) {\n  var result, $, category, optionDatas, options;\n  return _regeneratorRuntime.wrap(function getProductInfo$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          _context.prev = 0;\n          _context.next = 3;\n          return call(getProductInfoAPI, action.data);\n\n        case 3:\n          result = _context.sent;\n          _context.next = 6;\n          return cheerio.load(result.data);\n\n        case 6:\n          $ = _context.sent;\n          category = [];\n          optionDatas = [];\n          options = {\n            option: []\n          };\n          _context.next = 12;\n          return $('div#breadcrumb_feature_div a.a-link-child').each(function (i, elem) {\n            category.push($(elem).text().trim());\n          });\n\n        case 12:\n          _context.next = 14;\n          return $('script').filter(function (i, e) {\n            var data = $(e).data('a-state');\n\n            if (typeof data === 'object') {\n              return data.key === 'mobile-twister-dim-val-list' || data.key === 'mobile-twister-dims-to-asin-list' || data.key === 'mobile-twister-dim-list';\n            }\n          }).each(function (i, e) {\n            optionDatas[$(e).data('a-state').key] = JSON.parse($(e)[0].firstChild.data);\n          });\n\n        case 14:\n          _context.next = 16;\n          return function () {\n            options.listName = optionDatas['mobile-twister-dim-list'].key;\n            options.listValue = optionDatas['mobile-twister-dim-val-list'];\n\n            var key = _Object$keys(optionDatas['mobile-twister-dims-to-asin-list']).map(function (item) {\n              return item.match(/(\\d)/g);\n            });\n\n            var value = _Object$values(optionDatas['mobile-twister-dims-to-asin-list']);\n\n            options.option = key.map(function (item, index) {\n              return {\n                asin: value[index],\n                list: item\n              };\n            });\n          }();\n\n        case 16:\n          _context.next = 18;\n          return $('div#aplus_feature_div').children('div').find('img').filter(function (i, e) {\n            return $(e).hasClass('a-lazy-loaded');\n          }).each(function (i, e) {\n            $(e).attr('src', $(e).data('src'));\n          });\n\n        case 18:\n          _context.next = 20;\n          return put({\n            type: PRODUCT_INFORMATION_SUCCESS,\n            data: {\n              imageUrl: $('img#main-image').data('a-hires'),\n              price: $('div#cerberus-data-metrics').data('asin-price') || $('#priceblock_ourprice').text().trim().substring(1),\n              name: $('span#title').text().trim(),\n              category: category,\n              details: $('div#aplus3p_feature_div').length !== 0 ? $('div#aplus3p_feature_div').children('div').html() : $('div#aplus_feature_div').children('div').html(),\n              options: options\n            }\n          });\n\n        case 20:\n          _context.next = 27;\n          break;\n\n        case 22:\n          _context.prev = 22;\n          _context.t0 = _context[\"catch\"](0);\n          console.error(_context.t0);\n          _context.next = 27;\n          return put({\n            type: PRODUCT_INFORMATION_FAILURE\n          });\n\n        case 27:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, _marked, null, [[0, 22]]);\n}\n\nfunction watchProductInfo() {\n  return _regeneratorRuntime.wrap(function watchProductInfo$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.next = 2;\n          return takeEvery(PRODUCT_INFORMATION_REQUEST, getProductInfo);\n\n        case 2:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, _marked2);\n}\n\nfunction getOptionAPI(data) {\n  return axios(\"/api/product/option/\".concat(data.asin));\n}\n\nfunction getOptionInfo(action) {\n  var data;\n  return _regeneratorRuntime.wrap(function getOptionInfo$(_context3) {\n    while (1) {\n      switch (_context3.prev = _context3.next) {\n        case 0:\n          _context3.prev = 0;\n          _context3.next = 3;\n          return call(getOptionAPI, action.data);\n\n        case 3:\n          data = _context3.sent;\n          _context3.next = 6;\n          return data.data.filter(function (item) {\n            return item.asin === action.data.asin;\n          })[0];\n\n        case 6:\n          data = _context3.sent;\n          console.log(data, action.data.asin, action.data.index);\n          _context3.next = 10;\n          return put({\n            type: PRODUCT_OPTION_INFORMATION_SUCCESS,\n            data: {\n              imageUrl: data.imageUrl,\n              asin: action.data.asin,\n              index: action.data.index\n            }\n          });\n\n        case 10:\n          _context3.next = 17;\n          break;\n\n        case 12:\n          _context3.prev = 12;\n          _context3.t0 = _context3[\"catch\"](0);\n          console.log(_context3.t0);\n          _context3.next = 17;\n          return put({\n            type: PRODUCT_OPTION_INFORMATION_FAILURE\n          });\n\n        case 17:\n        case \"end\":\n          return _context3.stop();\n      }\n    }\n  }, _marked3, null, [[0, 12]]);\n}\n\nfunction watchOptionInfo() {\n  return _regeneratorRuntime.wrap(function watchOptionInfo$(_context4) {\n    while (1) {\n      switch (_context4.prev = _context4.next) {\n        case 0:\n          _context4.next = 2;\n          return takeEvery(PRODUCT_OPTION_INFORMATION_REQUEST, getOptionInfo);\n\n        case 2:\n        case \"end\":\n          return _context4.stop();\n      }\n    }\n  }, _marked4);\n}\n\nexport default function productSaga() {\n  return _regeneratorRuntime.wrap(function productSaga$(_context5) {\n    while (1) {\n      switch (_context5.prev = _context5.next) {\n        case 0:\n          _context5.next = 2;\n          return all([fork(watchProductInfo), fork(watchOptionInfo)]);\n\n        case 2:\n        case \"end\":\n          return _context5.stop();\n      }\n    }\n  }, _marked5);\n}","map":{"version":3,"sources":["/Users/dayong/Desktop/dev/bmazon/sagas/product.js"],"names":["getProductInfo","watchProductInfo","getOptionInfo","watchOptionInfo","productSaga","all","fork","takeEvery","call","put","axios","cheerio","PRODUCT_INFORMATION_SUCCESS","PRODUCT_INFORMATION_REQUEST","PRODUCT_INFORMATION_FAILURE","PRODUCT_OPTION_INFORMATION_REQUEST","PRODUCT_OPTION_INFORMATION_SUCCESS","PRODUCT_OPTION_INFORMATION_FAILURE","getProductInfoAPI","asin","action","data","result","load","$","category","optionDatas","options","option","each","i","elem","push","text","trim","filter","e","key","JSON","parse","firstChild","listName","listValue","map","item","match","value","index","list","children","find","hasClass","attr","type","imageUrl","price","substring","name","details","length","html","console","error","getOptionAPI","log"],"mappings":"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","sourcesContent":["import { all, fork, takeEvery, call, put } from 'redux-saga/effects';\nimport axios from 'axios';\nimport cheerio from 'cheerio';\n\nimport {\n  PRODUCT_INFORMATION_SUCCESS,\n  PRODUCT_INFORMATION_REQUEST,\n  PRODUCT_INFORMATION_FAILURE,\n  PRODUCT_OPTION_INFORMATION_REQUEST,\n  PRODUCT_OPTION_INFORMATION_SUCCESS,\n  PRODUCT_OPTION_INFORMATION_FAILURE,\n} from '../reducers/product';\n\nfunction getProductInfoAPI({ asin }) {\n  return axios(`/api/product/${asin}`);\n}\n\nfunction* getProductInfo(action) {\n  try {\n    const result = yield call(getProductInfoAPI, action.data);\n    const $ = yield cheerio.load(result.data);\n    const category = [];\n    const optionDatas = [];\n    const options = { option: [] };\n\n    yield $('div#breadcrumb_feature_div a.a-link-child').each((i, elem) => {\n      category.push(\n        $(elem)\n          .text()\n          .trim(),\n      );\n    });\n\n    yield $('script')\n      .filter((i, e) => {\n        const data = $(e).data('a-state');\n        if (typeof data === 'object') {\n          return (\n            data.key === 'mobile-twister-dim-val-list' ||\n            data.key === 'mobile-twister-dims-to-asin-list' ||\n            data.key === 'mobile-twister-dim-list'\n          );\n        }\n      })\n      .each((i, e) => {\n        optionDatas[$(e).data('a-state').key] = JSON.parse(\n          $(e)[0].firstChild.data,\n        );\n      });\n\n    yield (() => {\n      options.listName = optionDatas['mobile-twister-dim-list'].key;\n      options.listValue = optionDatas['mobile-twister-dim-val-list'];\n      const key = Object.keys(\n        optionDatas['mobile-twister-dims-to-asin-list'],\n      ).map(item => item.match(/(\\d)/g));\n      const value = Object.values(\n        optionDatas['mobile-twister-dims-to-asin-list'],\n      );\n      options.option = key.map((item, index) => ({\n        asin: value[index],\n        list: item,\n      }));\n    })();\n\n    // 늦게 로딩되는 이미지 로딩\n    yield $('div#aplus_feature_div')\n      .children('div')\n      .find('img')\n      .filter((i, e) => $(e).hasClass('a-lazy-loaded'))\n      .each((i, e) => {\n        $(e).attr('src', $(e).data('src'));\n      });\n\n    yield put({\n      type: PRODUCT_INFORMATION_SUCCESS,\n      data: {\n        imageUrl: $('img#main-image').data('a-hires'),\n        price:\n          $('div#cerberus-data-metrics').data('asin-price') ||\n          $('#priceblock_ourprice')\n            .text()\n            .trim()\n            .substring(1),\n        name: $('span#title')\n          .text()\n          .trim(),\n        category: category,\n        details:\n          $('div#aplus3p_feature_div').length !== 0\n            ? $('div#aplus3p_feature_div')\n                .children('div')\n                .html()\n            : $('div#aplus_feature_div')\n                .children('div')\n                .html(),\n        options: options,\n      },\n    });\n  } catch (e) {\n    console.error(e);\n    yield put({\n      type: PRODUCT_INFORMATION_FAILURE,\n    });\n  }\n}\n\nfunction* watchProductInfo() {\n  yield takeEvery(PRODUCT_INFORMATION_REQUEST, getProductInfo);\n}\n\nfunction getOptionAPI(data) {\n  return axios(`/api/product/option/${data.asin}`);\n}\n\nfunction* getOptionInfo(action) {\n  try {\n    let data = yield call(getOptionAPI, action.data);\n    data = yield data.data.filter(item => item.asin === action.data.asin)[0];\n    console.log(data, action.data.asin, action.data.index);\n    yield put({\n      type: PRODUCT_OPTION_INFORMATION_SUCCESS,\n      data: {\n        imageUrl: data.imageUrl,\n        asin: action.data.asin,\n        index: action.data.index,\n      },\n    });\n  } catch (e) {\n    console.log(e);\n    yield put({\n      type: PRODUCT_OPTION_INFORMATION_FAILURE,\n    });\n  }\n}\n\nfunction* watchOptionInfo() {\n  yield takeEvery(PRODUCT_OPTION_INFORMATION_REQUEST, getOptionInfo);\n}\n\nexport default function* productSaga() {\n  yield all([fork(watchProductInfo), fork(watchOptionInfo)]);\n}\n"]},"metadata":{},"sourceType":"module"}